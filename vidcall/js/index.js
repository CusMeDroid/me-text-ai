/* Powered By CusMeDroid */
$.getJSON("https://api.ipify.org?format=json",(function(e){console.log(e.ip),$("#myipaddr").html(e.ip)}));var serName,servers,pc,lineK=document.getElementById("kontakmain"),lineC=document.getElementById("callmain");function callNow(){var e=document.getElementById("nameserver");if(e.value<1)alert("Jangan Kosong!");else{lineK.style.display="none",lineC.style.display="block",serName=e.value;var s=document.getElementById("myipaddr").value;console.log("IP Address : "+s),firebase.database().ref("MeTextAI/VidCall/"+serName).set({id:yourId,ip:s,host:serName}),console.log("HOST : "+serName)}}if(""!=serName||""!=servers||""!=pc){var database=firebase.database().ref(),yourVideo=document.getElementById("yourVideo"),friendsVideo=document.getElementById("friendsVideo"),yourId=Math.floor(1e9*Math.random());function sendMessage(e,s){database.push({sender:e,message:s}).remove()}function readMessage(e){var s=JSON.parse(e.val().message);e.val().sender!=yourId&&(null!=s.serName?pc.addIceCandidate(new RTCIceCandidate(s.serName)):"offer"==s.sdp.type?pc.setRemoteDescription(new RTCSessionDescription(s.sdp)).then((()=>pc.createAnswer())).then((e=>pc.setLocalDescription(e))).then((()=>sendMessage(yourId,JSON.stringify({sdp:pc.localDescription})))):"answer"==s.sdp.type&&pc.setRemoteDescription(new RTCSessionDescription(s.sdp)))}function showMyFace(){serName==serName&&navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((e=>yourVideo.srcObject=e)).then((e=>pc.addStream(e)))}function showFriendsFace(){serName==serName&&pc.createOffer().then((e=>pc.setLocalDescription(e))).then((()=>sendMessage(yourId,JSON.stringify({sdp:pc.localDescription}))))}console.log("HOST : "+serName),servers={serName:[{urls:"stun:stun.services.mozilla.com"},{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"cusmedroid",username:"cusmedroidteam@gmail.com"}]},(pc=new RTCPeerConnection(servers)).onicecandidate=e=>e.candidate?sendMessage(yourId,JSON.stringify({serName:e.candidate})):console.log("\nID : "+yourId+"\nHOST : "+serName),pc.onaddstream=e=>friendsVideo.srcObject=e.stream,database.on("child_added",readMessage)}function closeKa(){location.href=""}
