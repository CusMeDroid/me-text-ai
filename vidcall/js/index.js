/* Powered By CusMeDroid */
$.getJSON("https://api.ipify.org?format=json",(function(e){console.log(e.ip),$("#myipaddr").html(e.ip)}));var serName,cukname,servers,pc,lineK=document.getElementById("kontakmain"),lineC=document.getElementById("callmain");function callNow(){var e=document.getElementById("nameserver");if(e.value<1)alert("Jangan Kosong!");else{lineK.style.display="none",lineC.style.display="block",serName=e.value;var a=document.getElementById("myipaddr").value;console.log("IP Address : "+a),firebase.database().ref("MeTextAI/VidCall/"+serName).set({id:yourId,ip:a,host:serName}),console.log("HOST : "+serName)}}if(""!=serName||""!=servers||""!=pc){var database=firebase.database().ref(),yourVideo=document.getElementById("yourVideo"),friendsVideo=document.getElementById("friendsVideo"),yourId=Math.floor(1e9*Math.random());function sendMessage(e,a){database.push({sender:e,message:a}).remove()}function readMessage(e){var a=JSON.parse(e.val().message);e.val().sender!=yourId&&(null!=a.serName?pc.addIceCandidate(new RTCIceCandidate(a.serName)):"offer"==a.sdp.type?pc.setRemoteDescription(new RTCSessionDescription(a.sdp)).then((()=>pc.createAnswer())).then((e=>pc.setLocalDescription(e))).then((()=>sendMessage(yourId,JSON.stringify({sdp:pc.localDescription})))):"answer"==a.sdp.type&&pc.setRemoteDescription(new RTCSessionDescription(a.sdp)))}function showMyFace(){firebase.database().ref("MeTextAI/VidCall/"+serName).on("value",(function(e){cukname=e.val().host})),""!=cukname&&serName==cukname&&navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((e=>yourVideo.srcObject=e)).then((e=>pc.addStream(e)))}function showFriendsFace(){firebase.database().ref("MeTextAI/VidCall/"+serName).on("value",(function(e){cukname=e.val().host})),""!=cukname&&serName==cukname&&pc.createOffer().then((e=>pc.setLocalDescription(e))).then((()=>sendMessage(yourId,JSON.stringify({sdp:pc.localDescription}))))}console.log("HOST : "+serName),servers={serName:[{urls:"stun:stun.services.mozilla.com"},{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"cusmedroid",username:"cusmedroidteam@gmail.com"}]},(pc=new RTCPeerConnection(servers)).onicecandidate=e=>e.candidate?sendMessage(yourId,JSON.stringify({serName:e.candidate})):console.log("\nID : "+yourId+"\nHOST : "+serName),pc.onaddstream=e=>friendsVideo.srcObject=e.stream,database.on("child_added",readMessage)}function closeKa(){location.href=""}
