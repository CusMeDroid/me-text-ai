/* Powered By CusMeDroid */
$.getJSON("https://api.ipify.org?format=json",(function(e){console.log(e.ip),$("#myipaddr").html(e.ip)}));var serName,servers,pc,lineK=document.getElementById("kontakmain"),lineC=document.getElementById("callmain"),database=firebase.database().ref(),yourVideo=document.getElementById("yourVideo"),friendsVideo=document.getElementById("friendsVideo"),yourId=Math.floor(1e9*Math.random());function callNow(){var e=document.getElementById("nameserver");if(e.value<1)alert("Jangan Kosong!");else{lineK.style.display="none",lineC.style.display="block",serName=e.value;var s=document.getElementById("myipaddr").value;console.log("IP Address : "+s),firebase.database().ref("MeTextAI/VidCall/"+serName).set({id:yourId,ip:s,host:serName}),servers={serName:[{urls:"stun:stun.services.mozilla.com"},{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"cusmedroid",username:"cusmedroidteam@gmail.com"}]},console.log("HOST : "+serName)}}function sendMessage(e,s){database.push({sender:e,message:s}).remove()}function readMessage(e){var s=JSON.parse(e.val().message);e.val().sender!=yourId&&(null!=s.ice?pc.addIceCandidate(new RTCIceCandidate(s.ice)):"offer"==s.sdp.type?pc.setRemoteDescription(new RTCSessionDescription(s.sdp)).then((()=>pc.createAnswer())).then((e=>pc.setLocalDescription(e))).then((()=>sendMessage(yourId,JSON.stringify({sdp:pc.localDescription})))):"answer"==s.sdp.type&&pc.setRemoteDescription(new RTCSessionDescription(s.sdp)))}function showMyFace(){navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((e=>yourVideo.srcObject=e)).then((e=>pc.addStream(e)))}function showFriendsFace(){pc.createOffer().then((e=>pc.setLocalDescription(e))).then((()=>sendMessage(yourId,JSON.stringify({sdp:pc.localDescription}))))}function closeKa(){location.href=""}(pc=new RTCPeerConnection(servers)).onicecandidate=e=>e.candidate?sendMessage(yourId,JSON.stringify({ice:e.candidate})):console.log("Sent All Ice \nID : "+yourId+"\nHOST : "+serName),pc.onaddstream=e=>friendsVideo.srcObject=e.stream,database.on("child_added",readMessage);
